<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayurveda Dashboard | HealthUnify by LuminaTech</title>
    <!-- Tailwind CSS (No separate CSS file needed) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles to replace external css/style.css and inject the theme */
        :root {
            --ayurveda-primary: #2D7A2E; /* Dark Green */
            --ayurveda-secondary: #E6E6FA; /* Light Lavender/Purple hint */
            --ayurveda-bg: #f4f7f6; /* Off-white background */
            --ayurveda-accent: #DAA520; /* Golden/Saffron */
            --glass-bg: rgba(255, 255, 255, 0.5);
            --glass-border: rgba(255, 255, 255, 0.8);
            --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .dashboard-body {
            font-family: 'Inter', sans-serif;
            background-color: var(--ayurveda-bg);
            display: flex;
            min-height: 100vh;
            color: #333;
            transition: background-color 0.3s;
        }

        /* Glass Effect Base */
        .glass-effect {
            backdrop-filter: blur(10px);
            background-color: var(--glass-bg);
            border-right: 1px solid var(--glass-border);
            box-shadow: var(--shadow-light);
        }

        /* Sidebar Styling */
        .sidebar {
            width: 280px;
            padding: 20px;
            transition: all 0.3s ease;
            position: fixed;
            height: 100%;
            z-index: 20;
            display: flex;
            flex-direction: column;
        }
        .sidebar.collapsed { width: 90px; }
        .sidebar.collapsed .logo-text,
        .sidebar.collapsed .user-info,
        .sidebar.collapsed .nav-item span,
        .sidebar.collapsed .btn-switch-system span { display: none; }
        .sidebar.collapsed .nav-item { justify-content: center; }
        .sidebar.collapsed .sidebar-header { justify-content: center; }
        .sidebar.collapsed .sidebar-toggle { position: absolute; top: 20px; right: -40px; }
        .sidebar.collapsed .user-avatar { margin: 0; }
        .sidebar.collapsed .sidebar-user { flex-direction: column; }
        .sidebar.collapsed .btn-logout-sidebar span { display: none; }

        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .sidebar-logo { width: 40px; height: 40px; margin-right: 10px; }
        .logo-text { font-size: 1.5rem; font-weight: 700; transition: opacity 0.3s; }
        .health-gradient { color: var(--ayurveda-primary); }
        .unify-gradient { color: var(--ayurveda-accent); }
        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--ayurveda-primary);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--ayurveda-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        .user-info h4 { font-size: 1rem; font-weight: 600; margin: 0; }
        .user-info .user-system { font-size: 0.75rem; color: #666; }

        .sidebar-nav { flex-grow: 1; }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 10px;
            color: #333;
            text-decoration: none;
            transition: all 0.2s;
            font-weight: 500;
        }
        .nav-item i { margin-right: 15px; width: 20px; text-align: center; }
        .nav-item:hover, .nav-item.active {
            background-color: var(--ayurveda-primary);
            color: white;
            box-shadow: 0 4px 10px rgba(45, 122, 46, 0.3);
        }

        .sidebar-footer {
            padding-top: 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        .btn-switch-system, .btn-logout-sidebar {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-weight: 600;
            transition: background-color 0.2s;
            cursor: pointer;
            border: none;
            text-decoration: none; /* For switch-system link */
        }
        .btn-switch-system {
            background-color: var(--ayurveda-accent);
            color: white;
        }
        .btn-logout-sidebar {
            background-color: #f8d7da;
            color: #721c24;
        }
        .btn-switch-system i, .btn-logout-sidebar i { margin-right: 10px; }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            flex-grow: 1;
            transition: margin-left 0.3s ease;
            padding: 20px;
        }
        .sidebar.collapsed + .main-content { margin-left: 90px; }

        /* Header */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            margin-bottom: 20px;
            border-radius: 15px;
            position: sticky;
            top: 20px;
            z-index: 10;
        }
        .header-left { display: flex; align-items: center; }
        .page-title-header { font-size: 1.8rem; font-weight: 700; color: var(--ayurveda-primary); margin: 0; }
        .header-right { display: flex; align-items: center; gap: 15px; }

        .search-box {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            padding: 8px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .search-box i { margin-right: 10px; color: #999; }
        .search-box input { border: none; outline: none; background: transparent; }

        .notification-btn {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            color: var(--ayurveda-primary);
        }
        .notification-dot {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background-color: #dc3545;
            border-radius: 50%;
        }
        .user-avatar-small { width: 40px; height: 40px; border-radius: 50%; }

        .mobile-menu-btn { display: none; }

        /* Content Body */
        .content-body { padding: 0 20px; }
        .content-section { display: none; padding-bottom: 50px; }
        .content-section.active { display: block; }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .glass-card {
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            padding: 25px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px 0 rgba(31, 38, 135, 0.15);
        }

        /* Welcome Card */
        .welcome-card {
            grid-column: span 1 / span 4;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, rgba(45, 122, 46, 0.8), rgba(135, 206, 235, 0.8));
            color: white;
        }
        .welcome-content h2 { font-size: 2rem; font-weight: 700; margin-bottom: 5px; }
        .welcome-content p { font-size: 1rem; margin: 0 0 15px; opacity: 0.9; }
        .ayurveda-icon-lg { font-size: 3rem; margin-right: 20px; }
        .welcome-date { font-size: 0.9rem; opacity: 0.8; }
        .welcome-date i { margin-right: 8px; }

        /* Dosha Cards */
        .dosha-card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.8);
        }
        .dosha-card h3 { font-size: 1.25rem; font-weight: 600; margin: 0; }
        .dosha-card p { font-size: 0.8rem; color: #666; margin-bottom: 15px; }
        .dosha-icon { font-size: 2rem; margin-bottom: 10px; }

        .vata-card { border-left: 5px solid #87CEEB; } /* Light Blue */
        .pitta-card { border-left: 5px solid #FF6347; } /* Tomato */
        .kapha-card { border-left: 5px solid #90EE90; } /* Light Green */
        
        .dosha-meter { width: 100%; display: flex; align-items: center; gap: 10px; }
        .dosha-progress { flex-grow: 1; height: 8px; background-color: #e0e0e0; border-radius: 4px; overflow: hidden; }
        .dosha-bar { height: 100%; border-radius: 4px; transition: width 0.5s; }
        .vata-bar { background-color: #87CEEB; }
        .pitta-bar { background-color: #FF6347; }
        .kapha-bar { background-color: #90EE90; }
        .dosha-percentage { font-size: 0.9rem; font-weight: 600; }

        /* Dashboard Rows */
        .dashboard-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        /* General Section Grid (for new content) */
        .section-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .section-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        .section-item-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--ayurveda-primary);
        }
        .section-item-header i { margin-right: 10px; font-size: 1.5rem; }
        .tip-list li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
        .tip-list li::before {
            content: '‚Ä¢';
            color: var(--ayurveda-accent);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
            position: absolute;
            left: 5px;
        }
        
        /* AI Vaidya Specific Styles */
        .chat-container {
            height: 500px;
            display: flex;
            flex-direction: column;
            border-radius: 15px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.7);
        }

        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .message {
            max-width: 80%;
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 15px;
            word-wrap: break-word;
        }

        .user-message {
            margin-left: auto;
            background-color: var(--ayurveda-primary);
            color: white;
            border-bottom-right-radius: 2px;
        }

        .assistant-message {
            margin-right: auto;
            background-color: var(--ayurveda-secondary);
            color: #333;
            border-bottom-left-radius: 2px;
        }

        .chat-input-area {
            display: flex;
            padding: 15px;
            gap: 10px;
            background: rgba(255, 255, 255, 0.9);
        }

        .report-analyzer-output {
            min-height: 400px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            padding: 20px;
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        /* Markdown Styling for API Output */
        .assistant-message h4 { font-weight: 700; margin-top: 10px; color: var(--ayurveda-primary); }
        .assistant-message ul { list-style: disc; padding-left: 20px; margin-top: 5px; }

        /* Loading Spinner */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--ayurveda-primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
            .welcome-card { grid-column: span 2 / span 2; }
            .dashboard-row, .section-grid-2 { grid-template-columns: 1fr; }
            .section-grid-3 { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                transform: translateX(-100%);
                display: none;
                border-right: none;
                border-bottom: 1px solid var(--glass-border);
            }
            .sidebar.active {
                transform: translateX(0);
                display: flex;
            }
            .sidebar.collapsed { width: 100%; }
            .sidebar.collapsed .sidebar-toggle { position: relative; right: 0; }
            
            .main-content { margin-left: 0; padding: 10px; }
            .content-header { padding: 10px; top: 10px; }
            .header-right { gap: 10px; }
            .search-box { display: none; }
            .mobile-menu-btn { display: block; margin-right: 15px; }
            .page-title-header { font-size: 1.5rem; }

            .dashboard-grid { grid-template-columns: 1fr; }
            .welcome-card { grid-column: span 1 / span 1; }
            .dosha-details-grid { grid-template-columns: 1fr; }
            .dashboard-row, .section-grid-2, .section-grid-3 { grid-template-columns: 1fr; }
        }

        /* Toast Message (omitted for brevity, keep existing toast styles) */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--ayurveda-primary);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(20px);
            display: flex;
            align-items: center;
            z-index: 100;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast i { margin-right: 10px; }
        
        /* Utility for fade-in animations */
        .fade-in-up {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        
        /* Placeholder for missing logo image */
        .sidebar-logo[onerror] {
            content: url('https://placehold.co/40x40/2D7A2E/ffffff?text=HU');
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="dashboard-body ayurveda-theme">
    
    <aside class="sidebar glass-effect ayurveda-sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="images/logo.png" alt="HealthUnify Logo" class="sidebar-logo" onerror="this.style.display='none'">
            <div class="logo-text">
                <span class="health-gradient">Health</span><span class="unify-gradient">Unify</span>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <div class="sidebar-user">
            <div class="user-avatar ayurveda-avatar">
                <i class="fas fa-leaf"></i>
            </div>
            <div class="user-info">
                <h4 id="userName">USER</h4>
                <span class="user-system ayurveda-system">Ayurveda System</span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </a>
            <a href="#dosha" class="nav-item" data-section="dosha">
                <i class="fas fa-yin-yang"></i>
                <span>Dosha Analysis</span>
            </a>
            <a href="#herbs" class="nav-item" data-section="herbs">
                <i class="fas fa-seedling"></i>
                <span>Herbal Medicines</span>
            </a>
            <a href="#diet" class="nav-item" data-section="diet">
                <i class="fas fa-apple-alt"></i>
                <span>Diet & Lifestyle</span>
            </a>
            <a href="#panchakarma" class="nav-item" data-section="panchakarma">
                <i class="fas fa-spa"></i>
                <span>Panchakarma</span>
            </a>
            <a href="#consultations" class="nav-item" data-section="consultations">
                <i class="fas fa-user-doctor"></i>
                <span>Consultations</span>
            </a>
            <a href="#seasonal" class="nav-item" data-section="seasonal">
                <i class="fas fa-calendar-days"></i>
                <span>Seasonal Guide</span>
            </a>
            <a href="#yoga" class="nav-item" data-section="yoga">
                <i class="fas fa-person-praying"></i>
                <span>Yoga & Meditation</span>
            </a>
             <!-- NEW AI VAIDYA TAB -->
            <a href="#ai-vaidya" class="nav-item" data-section="ai-vaidya">
                <i class="fas fa-robot"></i>
                <span>AI Vaidya</span>
            </a>
            <a href="choose-system.html" class="btn-switch-system ripple-effect ayurveda-btn">
                <i class="fas fa-repeat"></i> <span>Switch System</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button class="btn-logout-sidebar ripple-effect" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
            </button>
        </div>
    </aside>

   
    <main class="main-content">
        
        <header class="content-header glass-effect">
            <div class="header-left">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="page-title-header" id="pageTitle">Ayurveda Dashboard</h1>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search records...">
                </div>
                <button class="notification-btn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-dot"></span>
                </button>
                <div class="user-menu">
                    <img id="userAvatarSmall" src="https://ui-avatars.com/api/?name=User&background=2D7A2E&color=fff" alt="User" class="user-avatar-small">
                </div>
            </div>
        </header>

        
        <div class="content-body">
            
            <section id="section-dashboard" class="content-section active">
                <div class="dashboard-grid">
                    
                    <div class="welcome-card glass-card ayurveda-card fade-in-up">
                        <div class="welcome-content flex items-center">
                            <div class="ayurveda-icon-lg">
                                <i class="fas fa-om"></i>
                            </div>
                            <div>
                                <h2>Namaste, <span id="dashboardUserName">Demo Patient</span></h2>
                                <p>Balance your mind, body, and spirit with Ayurveda</p>
                                <div class="welcome-date">
                                    <i class="fas fa-calendar"></i>
                                    <span id="currentDate"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="dosha-card glass-card fade-in-up delay-1 vata-card">
                        <div class="dosha-icon">
                            <i class="fas fa-wind"></i>
                        </div>
                        <div class="dosha-info">
                            <h3>Vata</h3>
                            <p>Air & Space</p>
                        </div>
                        <div class="dosha-meter">
                            <div class="dosha-progress">
                                <div class="dosha-bar vata-bar" id="vataBar" style="width: 35%"></div>
                            </div>
                            <span class="dosha-percentage" id="vataPercentage">35%</span>
                        </div>
                    </div>

                    <div class="dosha-card glass-card fade-in-up delay-2 pitta-card">
                        <div class="dosha-icon">
                            <i class="fas fa-fire"></i>
                        </div>
                        <div class="dosha-info">
                            <h3>Pitta</h3>
                            <p>Fire & Water</p>
                        </div>
                        <div class="dosha-meter">
                            <div class="dosha-progress">
                                <div class="dosha-bar pitta-bar" id="pittaBar" style="width: 40%"></div>
                            </div>
                            <span class="dosha-percentage" id="pittaPercentage">40%</span>
                        </div>
                    </div>

                    <div class="dosha-card glass-card fade-in-up delay-3 kapha-card">
                        <div class="dosha-icon">
                            <i class="fas fa-water"></i>
                        </div>
                        <div class="dosha-info">
                            <h3>Kapha</h3>
                            <p>Water & Earth</p>
                        </div>
                        <div class="dosha-meter">
                            <div class="dosha-progress">
                                <div class="dosha-bar kapha-bar" id="kaphaBar" style="width: 25%"></div>
                            </div>
                            <span class="dosha-percentage" id="kaphaPercentage">25%</span>
                        </div>
                    </div>
                </div>

                
                <div class="dashboard-row">
                    <div class="prakriti-card glass-card fade-in-up">
                        <h3><i class="fas fa-user-check"></i> Your Prakriti (Constitution)</h3>
                        <div class="prakriti-result">
                            <div class="prakriti-type">
                                <div class="type-badge pitta-dominant" id="prakritiBadge">Pitta-Vata</div>
                                <p id="prakritiDescription">You have a predominant Pitta constitution with Vata tendencies</p>
                            </div>
                            <div class="prakriti-characteristics">
                                <h4>Key Characteristics:</h4>
                                <ul id="prakritiCharacteristics">
                                    <li><i class="fas fa-check-circle"></i> Strong digestion and metabolism</li>
                                    <li><i class="fas fa-check-circle"></i> Sharp intellect and focus</li>
                                    <li><i class="fas fa-check-circle"></i> Creative and energetic</li>
                                    <li><i class="fas fa-check-circle"></i> Tendency towards heat sensitivity</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="recommendations-card glass-card fade-in-up delay-1">
                        <h3><i class="fas fa-lightbulb"></i> Today's Recommendations</h3>
                        <div class="recommendations-list">
                            <div class="recommendation-item">
                                <div class="rec-icon diet-icon">
                                    <i class="fas fa-apple-alt"></i>
                                </div>
                                <div class="rec-content">
                                    <h4>Diet Advice</h4>
                                    <p>Include cooling foods like cucumber, coconut water, and mint</p>
                                </div>
                            </div>
                            <div class="recommendation-item">
                                <div class="rec-icon yoga-icon">
                                    <i class="fas fa-spa"></i>
                                </div>
                                <div class="rec-content">
                                    <h4>Yoga Practice</h4>
                                    <p>Practice cooling pranayama like Shitali for 10 minutes</p>
                                </div>
                            </div>
                            <div class="recommendation-item">
                                <div class="rec-icon lifestyle-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="rec-content">
                                    <h4>Lifestyle Tip</h4>
                                    <p>Avoid excessive heat and spicy foods during midday</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="dashboard-row">
                    <div class="herbs-summary-card glass-card fade-in-up">
                        <div class="card-header-flex">
                            <h3><i class="fas fa-seedling"></i> Current Herbal Medicines</h3>
                            <button class="btn-link">View All</button>
                        </div>
                        <div class="herbs-list">
                            <div class="herb-item">
                                <div class="herb-icon">
                                    <i class="fas fa-leaf"></i>
                                </div>
                                <div class="herb-details">
                                    <h4>Ashwagandha Churna</h4>
                                    <p>1 tsp with warm milk before bed</p>
                                    <span class="herb-purpose">For stress relief & vitality</span>
                                </div>
                            </div>
                            <div class="herb-item">
                                <div class="herb-icon">
                                    <i class="fas fa-leaf"></i>
                                </div>
                                <div class="herb-details">
                                    <h4>Triphala</h4>
                                    <p>2 tablets after dinner</p>
                                    <span class="herb-purpose">For digestive health</span>
                                </div>
                            </div>
                            <div class="herb-item">
                                <div class="herb-icon">
                                    <i class="fas fa-leaf"></i>
                                </div>
                                <div class="herb-details">
                                    <h4>Brahmi Tea</h4>
                                    <p>1 cup in the morning</p>
                                    <span class="herb-purpose">For mental clarity</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="diet-plan-card glass-card fade-in-up delay-1">
                        <div class="card-header-flex">
                            <h3><i class="fas fa-utensils"></i> Daily Diet Plan</h3>
                            <button class="btn-link">Customize</button>
                        </div>
                        <div class="meal-timeline">
                            <div class="meal-item">
                                <div class="meal-time">
                                    <span class="time-icon">üåÖ</span>
                                    <span class="time-text">6:00 AM</span>
                                </div>
                                <div class="meal-content">
                                    <h4>Morning Routine</h4>
                                    <p>Warm water with lemon, tongue scraping, oil pulling</p>
                                </div>
                            </div>
                            <div class="meal-item">
                                <div class="meal-time">
                                    <span class="time-icon">‚òÄÔ∏è</span>
                                    <span class="time-text">8:00 AM</span>
                                </div>
                                <div class="meal-content">
                                    <h4>Breakfast</h4>
                                    <p>Oats porridge with dates and almonds</p>
                                </div>
                            </div>
                            <div class="meal-item">
                                <div class="meal-time">
                                    <span class="time-icon">üå§Ô∏è</span>
                                    <span class="time-text">12:30 PM</span>
                                </div>
                                <div class="meal-content">
                                    <h4>Lunch</h4>
                                    <p>Rice, dal, vegetables, and buttermilk</p>
                                </div>
                            </div>
                            <div class="meal-item">
                                <div class="meal-time">
                                    <span class="time-icon">üåô</span>
                                    <span class="time-text">7:00 PM</span>
                                </div>
                                <div class="meal-content">
                                    <h4>Dinner</h4>
                                    <p>Light khichdi with ghee and vegetables</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="dashboard-row">
                    <div class="seasonal-card glass-card fade-in-up">
                        <h3><i class="fas fa-calendar-alt"></i> Current Season: Sharad (Autumn)</h3>
                        <div class="seasonal-content">
                            <p class="seasonal-desc">Autumn is a transitional season where Pitta accumulated during summer may get aggravated.</p>
                            <div class="seasonal-tips">
                                <h4>Ritucharya (Seasonal Regimen):</h4>
                                <ul>
                                    <li>Prefer cooling and sweet foods</li>
                                    <li>Avoid excessive exposure to sun</li>
                                    <li>Practice calming yoga and meditation</li>
                                    <li>Take evening walks in pleasant weather</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="yoga-tracker-card glass-card fade-in-up delay-1">
                        <h3><i class="fas fa-person-praying"></i> Yoga & Meditation Tracker</h3>
                        <div class="practice-stats">
                            <div class="stat-circle">
                                <svg class="progress-circle" width="100" height="100">
                                    <circle cx="50" cy="50" r="45" stroke="#e0e0e0" stroke-width="6" fill="none"/>
                                    <circle cx="50" cy="50" r="45" stroke="#2D7A2E" stroke-width="6" fill="none" 
                                            stroke-dasharray="283" stroke-dashoffset="70" transform="rotate(-90 50 50)" id="yogaProgress"/>
                                </svg>
                                <div class="stat-text">
                                    <span class="stat-number" id="yogaGoalPercentage">75%</span>
                                    <span class="stat-label">Weekly Goal</span>
                                </div>
                            </div>
                            <div class="practice-details">
                                <div class="practice-item">
                                    <span class="practice-label">This Week:</span>
                                    <span class="practice-value">5 sessions</span>
                                </div>
                                <div class="practice-item">
                                    <span class="practice-label">Total Time:</span>
                                    <span class="practice-value">3.5 hours</span>
                                </div>
                                <div class="practice-item">
                                    <span class="practice-label">Streak:</span>
                                    <span class="practice-value">12 days üî•</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            
            <section id="section-dosha" class="content-section">
                <div class="dosha-analysis-container">
                    <h2 class="section-title-main">Dosha Analysis</h2>
                    <p class="section-subtitle">Understanding your unique mind-body constitution</p>

                    <div class="dosha-chart-card glass-card">
                        <h3>Your Dosha Distribution</h3>
                        <canvas id="doshaChart"></canvas>
                    </div>

                    <div class="dosha-details-grid">
                        <div class="dosha-detail-card glass-card vata-detail">
                            <div class="detail-header">
                                <i class="fas fa-wind"></i>
                                <h3>Vata (Air & Space)</h3>
                            </div>
                            <p><strong>Balance State:</strong> <span id="vataBalanceState">Moderate</span></p>
                            <h4>Characteristics:</h4>
                            <ul>
                                <li>Creative and enthusiastic</li>
                                <li>Quick thinking and adaptable</li>
                                <li>Light sleeper</li>
                            </ul>
                            <h4>When Imbalanced:</h4>
                            <ul>
                                <li>Anxiety and restlessness</li>
                                <li>Irregular digestion</li>
                                <li>Insomnia</li>
                            </ul>
                        </div>

                        <div class="dosha-detail-card glass-card pitta-detail">
                            <div class="detail-header">
                                <i class="fas fa-fire"></i>
                                <h3>Pitta (Fire & Water)</h3>
                            </div>
                            <p><strong>Balance State:</strong> <span id="pittaBalanceState">Good</span></p>
                            <h4>Characteristics:</h4>
                            <ul>
                                <li>Strong digestion</li>
                                <li>Sharp intellect</li>
                                <li>Natural leadership</li>
                            </ul>
                            <h4>When Imbalanced:</h4>
                            <ul>
                                <li>Irritability and anger</li>
                                <li>Inflammation</li>
                                <li>Excessive heat</li>
                            </ul>
                        </div>

                        <div class="dosha-detail-card glass-card kapha-detail">
                            <div class="detail-header">
                                <i class="fas fa-water"></i>
                                <h3>Kapha (Water & Earth)</h3>
                            </div>
                            <p><strong>Balance State:</strong> <span id="kaphaBalanceState">Low</span></p>
                            <h4>Characteristics:</h4>
                            <ul>
                                <li>Calm and stable</li>
                                <li>Strong endurance</li>
                                <li>Compassionate</li>
                            </ul>
                            <h4>When Imbalanced:</h4>
                            <ul>
                                <li>Lethargy and sluggishness</li>
                                <li>Weight gain</li>
                                <li>Congestion</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- HERBAL MEDICINES SECTION (omitted for brevity) -->
            <section id="section-herbs" class="content-section">
                <h2 class="section-title-main">Herbal Medicines</h2>
                <p class="section-subtitle">Personalized herbal regimen to support your Pitta-Vata balance.</p>

                <div class="section-grid-2">
                    <div class="glass-card">
                        <div class="section-item-header">
                            <i class="fas fa-prescription-bottle-alt"></i>
                            Prescribed Herbs
                        </div>
                        <p class="mb-4 text-sm text-gray-600">These herbs are currently recommended to balance your elevated Pitta and manage Vata's dryness and mobility.</p>
                        
                        <div class="space-y-4">
                            <div class="herb-item p-3 border rounded-lg bg-white/70">
                                <div class="herb-icon bg-red-500/80">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div class="herb-details">
                                    <h4>**Shatavari** (Cooling Tonic)</h4>
                                    <p>Dosage: 1 tsp powder with cool water, 2x daily</p>
                                    <span class="herb-purpose text-red-600">Action: **Pitta-Pacifying**, Moisturizes tissues (Vata)</span>
                                </div>
                            </div>
                            <div class="herb-item p-3 border rounded-lg bg-white/70">
                                <div class="herb-icon bg-blue-500/80">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <div class="herb-details">
                                    <h4>**Brahmi** (Nervine Tonic)</h4>
                                    <p>Dosage: 500mg capsule in the morning</p>
                                    <span class="herb-purpose text-blue-600">Action: **Vata-Calming**, Supports mental clarity (Pitta)</span>
                                </div>
                            </div>
                            <div class="herb-item p-3 border rounded-lg bg-white/70">
                                <div class="herb-icon bg-yellow-600/80">
                                    <i class="fas fa-leaf"></i>
                                </div>
                                <div class="herb-details">
                                    <h4>**Amalaki (Indian Gooseberry)**</h4>
                                    <p>Dosage: 1 tsp fresh juice or powder after lunch</p>
                                    <span class="herb-purpose text-yellow-700">Action: Potent anti-oxidant, **Balances all three Doshas**</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card">
                        <div class="section-item-header">
                            <i class="fas fa-flask"></i>
                            Herb Usage Guidelines
                        </div>
                        <ul class="tip-list list-none p-0 space-y-2 text-gray-700">
                            <li>**Anupana (Vehicle):** Take Vata-calming herbs with warm milk or ghee, and Pitta-calming herbs with cool water or honey.</li>
                            <li>**Timing:** Digestive support like Triphala is best taken before bed, while tonics like Ashwagandha can be taken in the morning or evening.</li>
                            <li>**Quality:** Always source high-quality, organic herbs to ensure maximum potency.</li>
                            <li>**Interactions:** Consult your practitioner before combining new herbs with existing supplements or medications.</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- DIET & LIFESTYLE SECTION (omitted for brevity) -->
            <section id="section-diet" class="content-section">
                <h2 class="section-title-main">Diet & Lifestyle</h2>
                <p class="section-subtitle">Cooling, grounding, and nourishing practices for Pitta-Vata balance.</p>

                <div class="section-grid-2">
                    <div class="glass-card">
                        <div class="section-item-header text-red-600">
                            <i class="fas fa-heart"></i>
                            Pitta-Vata Diet Principles
                        </div>
                        <ul class="tip-list list-disc p-0 space-y-2">
                            <li>**Taste Profile:** Favor Sweet, Bitter, and Astringent tastes.</li>
                            <li>**Avoid:** Pungent, Sour, and Salty foods, which aggravate Pitta.</li>
                            <li>**Hydration:** Drink plenty of cool, non-iced liquids (e.g., fennel tea, coconut water).</li>
                            <li>**Oils:** Use cooling fats like **Ghee** and **Coconut Oil** generously to counteract Pitta's heat and Vata's dryness.</li>
                            <li>**Mealtimes:** Eat your largest meal at lunch when digestive fire (Agni) is strongest. Never skip meals.</li>
                        </ul>
                    </div>

                    <div class="glass-card">
                        <div class="section-item-header text-blue-600">
                            <i class="fas fa-sun"></i>
                            Daily Lifestyle (Dinacharya)
                        </div>
                        <ul class="tip-list list-disc p-0 space-y-2">
                            <li>**Abhyanga (Self-Massage):** Daily massage with **Coconut** or **Almond oil** to soothe Vata.</li>
                            <li>**Midday Rest:** Take 10-15 minutes of quiet time or rest during the heat of the day (Pitta time).</li>
                            <li>**Routine:** Maintain a **consistent daily schedule** (Vata-pacifying). Try to go to bed before 10 PM.</li>
                            <li>**Exercise:** Choose moderate, cooling exercises like swimming or gentle hiking. Avoid intense, competitive, or overheated workouts.</li>
                            <li>**Aromatherapy:** Use cooling essential oils like sandalwood, rose, or lavender.</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- PANCHAKARMA SECTION (omitted for brevity) -->
            <section id="section-panchakarma" class="content-section">
                <h2 class="section-title-main">Panchakarma</h2>
                <p class="section-subtitle">Deep cleansing therapies for periodic detoxification and Dosha balancing.</p>
                
                <div class="section-grid-3">
                    <div class="glass-card">
                        <div class="section-item-header text-green-700">
                            <i class="fas fa-hands-praying"></i>
                            Virechana (Purgation)
                        </div>
                        <p class="text-sm italic mb-3">Therapy to eliminate accumulated Pitta from the small intestine.</p>
                        <ul class="tip-list list-none p-0 space-y-1 text-gray-700">
                            <li>**Best for:** Reducing heat, inflammation, and skin issues.</li>
                            <li>**Procedure:** Medicated purgation under supervision.</li>
                            <li>**Timing:** Recommended during the cooling season (Autumn).</li>
                        </ul>
                    </div>
                    <div class="glass-card">
                        <div class="section-item-header text-blue-700">
                            <i class="fas fa-water"></i>
                            Basti (Medicated Enema)
                        </div>
                        <p class="text-sm italic mb-3">Considered the primary treatment for balancing Vata Dosha.</p>
                        <ul class="tip-list list-none p-0 space-y-1 text-gray-700">
                            <li>**Best for:** Chronic pain, dryness, and neurological disorders.</li>
                            <li>**Procedure:** Utilizes herbal oils/decoctions.</li>
                            <li>**Timing:** Best during late Autumn or Winter.</li>
                        </ul>
                    </div>
                    <div class="glass-card">
                        <div class="section-item-header text-yellow-700">
                            <i class="fas fa-hand-holding-medical"></i>
                            Shirodhara (Head Oil Drip)
                        </div>
                        <p class="text-sm italic mb-3">A deeply relaxing therapy where warm oil is poured continuously over the forehead.</p>
                        <ul class="tip-list list-none p-0 space-y-1 text-gray-700">
                            <li>**Best for:** Stress, anxiety, insomnia (Vata/Pitta).</li>
                            <li>**Procedure:** Uses Pitta-calming oils (e.g., coconut, brahmi).</li>
                            <li>**Timing:** Can be done year-round, especially when stressed.</li>
                        </ul>
                    </div>
                </div>

                <div class="glass-card mt-6">
                    <div class="section-item-header text-red-600">
                        <i class="fas fa-calendar-check"></i>
                        Upcoming Panchakarma Schedule
                    </div>
                    <p class="text-sm text-gray-600 mb-3">Your practitioner has recommended a preparatory schedule leading up to your Virechana therapy.</p>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Therapy</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Purpose</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white/50 divide-y divide-gray-200">
                            <tr class="hover:bg-gray-100/50">
                                <td class="px-6 py-4 whitespace-nowrap">Oct 20th</td>
                                <td class="px-6 py-4 whitespace-nowrap">Snehana (Oil intake)</td>
                                <td class="px-6 py-4 whitespace-nowrap">Internal oleation (7 days)</td>
                            </tr>
                            <tr class="hover:bg-gray-100/50">
                                <td class="px-6 py-4 whitespace-nowrap">Oct 27th</td>
                                <td class="px-6 py-4 whitespace-nowrap">Swedana (Steam Bath)</td>
                                <td class="px-6 py-4 whitespace-nowrap">External Fomentation</td>
                            </tr>
                            <tr class="hover:bg-gray-100/50 font-bold bg-yellow-100/50">
                                <td class="px-6 py-4 whitespace-nowrap">Oct 28th</td>
                                <td class="px-6 py-4 whitespace-nowrap">Virechana (Main Therapy)</td>
                                <td class="px-6 py-4 whitespace-nowrap">Pitta elimination</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- CONSULTATIONS SECTION (omitted for brevity) -->
            <section id="section-consultations" class="content-section">
                <h2 class="section-title-main">Consultations</h2>
                <p class="section-subtitle">Book new consultations and view past reports with your Ayurvedic specialist.</p>
                <div class="glass-card p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Past Consultation Reports</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-3 rounded-lg bg-gray-50/50 border">
                            <div class="flex items-center">
                                <i class="fas fa-file-pdf text-red-500 mr-3"></i>
                                <span>Report - Summer 2023 (Pitta Imbalance)</span>
                            </div>
                            <button class="text-sm text-blue-600 hover:text-blue-800 font-medium">Download</button>
                        </div>
                        <div class="flex justify-between items-center p-3 rounded-lg bg-gray-50/50 border">
                            <div class="flex items-center">
                                <i class="fas fa-file-pdf text-red-500 mr-3"></i>
                                <span>Initial Assessment - Jan 2023 (Prakriti Confirmed)</span>
                            </div>
                            <button class="text-sm text-blue-600 hover:text-blue-800 font-medium">Download</button>
                        </div>
                    </div>
                    <button class="mt-6 w-full py-2 bg-green-700 text-white rounded-lg shadow-md hover:bg-green-800 transition">Book a New Virtual Consultation</button>
                </div>
            </section>
            
            <!-- SEASONAL GUIDE SECTION (omitted for brevity) -->
            <section id="section-seasonal" class="content-section">
                <h2 class="section-title-main">Seasonal Guide (Ritucharya)</h2>
                <p class="section-subtitle">Adapt your routine to the current season: **Sharad Ritu (Autumn)**</p>
                
                <div class="section-grid-2">
                    <div class="glass-card">
                        <div class="section-item-header text-yellow-700">
                            <i class="fas fa-leaf"></i>
                            Sharad Ritu Focus (Mid-Sept to Mid-Nov)
                        </div>
                        <p class="text-sm italic mb-3 text-gray-600">This season brings dryness (Vata) and the potential for aggravated heat (Pitta) accumulated during summer. The focus is cooling and moisturizing.</p>
                        
                        <h4 class="font-semibold mt-4 mb-2 text-gray-700">Recommended Diet:</h4>
                        <ul class="tip-list list-none p-0 space-y-1 text-sm">
                            <li>Eat naturally sweet and easily digestible foods (rice, wheat).</li>
                            <li>Include bitter and astringent vegetables (gourds, green beans).</li>
                            <li>Avoid excessive exposure to sunlight, especially at midday.</li>
                            <li>Favor cooling drinks like sweet lassi or sugar cane juice.</li>
                        </ul>
                    </div>

                    <div class="glass-card">
                        <div class="section-item-header text-green-700">
                            <i class="fas fa-person-running"></i>
                            Seasonal Activities
                        </div>
                        <h4 class="font-semibold mt-4 mb-2 text-gray-700">Do's:</h4>
                        <ul class="tip-list list-none p-0 space-y-1 text-sm">
                            <li>Wear light, cooling clothing.</li>
                            <li>Perform a gentle body massage (Abhyanga) with coconut oil.</li>
                            <li>Take a mild purgative (Virechana) with your doctor's advice.</li>
                        </ul>
                        <h4 class="font-semibold mt-4 mb-2 text-red-600">Don'ts:</h4>
                        <ul class="tip-list list-none p-0 space-y-1 text-sm">
                            <li>Avoid sleeping directly on the floor or exposing yourself to direct sun.</li>
                            <li>Restrict heavy, oily, or spicy foods.</li>
                            <li>Avoid excess physical exertion, particularly at noon.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- YOGA & MEDITATION SECTION (omitted for brevity) -->
            <section id="section-yoga" class="content-section">
                <h2 class="section-title-main">Yoga & Meditation</h2>
                <p class="section-subtitle">Calming, grounding, and cooling practices for mind-body harmony.</p>
                
                <div class="section-grid-2">
                    <div class="glass-card">
                        <div class="section-item-header text-purple-700">
                            <i class="fas fa-person-yoga"></i>
                            Asana Recommendations (Yoga Poses)
                        </div>
                        <p class="text-sm italic mb-3 text-gray-600">Focus on poses that are gentle and grounding to soothe Vata, and non-heating to cool Pitta.</p>
                        <h4 class="font-semibold mt-4 mb-2 text-gray-700">For Vata/Pitta:</h4>
                        <ul class="tip-list list-disc p-0 space-y-1 text-sm">
                            <li>**Vajrasana (Thunderbolt Pose):** Aids digestion and grounds energy.</li>
                            <li>**Paschimottanasana (Seated Forward Bend):** Calms the nervous system.</li>
                            <li>**Shavasana (Corpse Pose):** Essential for deep rest and integration (longer than 5 min).</li>
                            <li>**Lunar Salutations:** Preferable over heating Sun Salutations.</li>
                        </ul>
                    </div>
                    
                    <div class="glass-card">
                        <div class="section-item-header text-pink-700">
                            <i class="fas fa-om"></i>
                            Pranayama & Meditation
                        </div>
                        <h4 class="font-semibold mt-4 mb-2 text-gray-700">Pranayama (Breathwork):</h4>
                        <ul class="tip-list list-disc p-0 space-y-1 text-sm">
                            <li>**Sheetali Pranayama (Cooling Breath):** Primary practice to reduce excess Pitta heat.</li>
                            <li>**Nadi Shodhana (Alternate Nostril):** Excellent for calming the Vata mind and balancing energy.</li>
                            <li>**Avoid:** Bhastrika (Bellows Breath) as it is too heating.</li>
                        </ul>
                        <h4 class="font-semibold mt-4 mb-2 text-gray-700">Meditation:</h4>
                        <ul class="tip-list list-disc p-0 space-y-1 text-sm">
                            <li>**Mantra Meditation:** Use a gentle, cooling mantra (e.g., *Om Shanti*).</li>
                            <li>**Water Gazing:** Sitting by a cool body of water to pacify Pitta.</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <!-- NEW AI VAIDYA SECTION -->
            <section id="section-ai-vaidya" class="content-section">
                <h2 class="section-title-main">AI Vaidya: Your Personalized Assistant</h2>
                <p class="section-subtitle">Get instant Ayurvedic guidance and professional health report analysis.</p>

                <div class="section-grid-2">
                    
                    <!-- AI CHAT ASSISTANT -->
                    <div class="glass-card p-0 overflow-hidden">
                        <div class="section-item-header p-5 pb-0 text-indigo-700">
                            <i class="fas fa-comment-dots"></i>
                            Ayurveda Chat Assistant
                        </div>
                        <div class="chat-container">
                            <div class="chat-messages" id="chatMessages">
                                <div class="message assistant-message">
                                    Namaste! I am AI Vaidya, your expert guide in holistic wellness. Ask me anything about Doshas, remedies, or lifestyle!
                                </div>
                            </div>
                            <div class="chat-input-area">
                                <input type="text" id="chatInput" placeholder="Ask about Pitta-Vata balance, Ashwagandha, etc..." 
                                       class="flex-grow p-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 transition"
                                       onkeydown="if(event.key === 'Enter') document.getElementById('chatSubmit').click()">
                                <button id="chatSubmit" 
                                        class="bg-green-600 text-white px-4 py-2 rounded-xl font-semibold shadow-md hover:bg-green-700 transition disabled:opacity-50">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI REPORT ANALYZER -->
                    <div class="glass-card">
                        <div class="section-item-header text-red-600">
                            <i class="fas fa-file-waveform"></i>
                            AI Health Report Analyzer
                        </div>
                        <p class="text-sm mb-4 text-gray-600">Paste your recent symptoms, consultation notes, or medical results below for an Ayurvedic interpretation.</p>

                        <textarea id="reportInput" rows="6" placeholder="Example: I've been experiencing chronic inflammation, joint pain in the mornings, and increased irritability in the afternoon. My sleep is poor and interrupted."
                            class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 transition bg-white/70 mb-4"></textarea>

                        <button id="analyzeReportBtn" 
                                class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold shadow-md hover:bg-red-700 transition disabled:opacity-50">
                            Analyze from Ayurvedic Perspective
                        </button>
                        
                        <div class="mt-6">
                            <h4 class="font-bold text-lg text-gray-800 border-b pb-2 mb-3 flex items-center">
                                Analysis Result 
                                <span id="reportLoader" class="loader ml-3 hidden"></span>
                            </h4>
                            <div id="reportOutput" class="report-analyzer-output glass-card min-h-[300px] shadow-inner text-gray-700">
                                Your Ayurvedic analysis will appear here. It will detail Dosha imbalances (Vikriti) and offer specific recommendations.
                            </div>
                        </div>
                    </div>
                </div>
            </section>


            <section id="section-settings" class="content-section">
                <h2 class="section-title-main">Settings</h2>
                <p>Update your profile and application preferences.</p>
            </section>
        </div>
    </main>

    
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Action completed!</span>
    </div>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc, collection, query, where, limit, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase and App State variables
        let app, db, auth;
        let userId = null;
        let doshaChartInstance = null;
        //const API_BASE_URL = "https://generativelanguage.googleapis.com/v1beta/models/";
        //const API_KEY = "AIzaSyBydtgk8kzKmKiwikD5DxtkSo0345-G67Y"; // Provided by the Canvas environment
        //const ANALYSIS_MODEL = "gemini-2.5-flash-preview-05-20"; // Model for structured analysis
        const CHAT_MODEL = "gemini-2.5-flash-preview-05-20"; // Model for conversational chat
        const MODEL_NAME = "gemini-2.5-flash-preview-05-20";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=`; // API key placeholder
        const apiKey = "AIzaSyBydtgk8kzKmKiwikD5DxtkSo0345-G67Y"; // Canvas will automatically provide the API key
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
        apiKey: "AIzaSyAEKdA_WIfzmyIQXkYkVB1LFlzDWrSJcKQ",
        authDomain: "medical-8d4a3.firebaseapp.com",
        projectId: "medical-8d4a3",
        storageBucket: "medical-8d4a3.firebasestorage.app",
        messagingSenderId: "365241148803",
        appId: "1:365241148803:web:2ffde56c462459b08c42b6",
        measurementId: "G-PFCZX6JJDF"
        };
        // Configuration from the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-ayurveda-app';
        //const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // --- Utility Functions ---

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toastMessage');
            
            // Note: In a real app, you'd handle 'error' styles too.
            toast.className = 'toast show';
            messageEl.textContent = message;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        /**
         * Generic function to call the Gemini  with exponential backoff.
         * @param {string} userQuery - The main query text for the model.
         * @param {string} systemPrompt - Instructions defining the model's persona.
         * @param {number} maxRetries - Maximum number of retries for the API call.
         * @returns {Promise<string>} The generated text response.
         */
        async function retryFetch(url, payload, maxRetries = 3) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url + apiKey, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        if (text) {
                            return text;
                        } else {
                            throw new Error("API response was missing generated text.");
                        }
                    } else if (response.status === 429) {
                        // Rate limit exceeded, retry with backoff
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    } else {
                        // Other non-retryable errors
                        throw new Error(`API returned status code ${response.status}: ${response.statusText}`);
                    }
                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("Gemini API call failed after max retries:", error);
                        throw new Error("Failed to get a response from the AI assistant.");
                    }
                    // For network errors or internal logic errors, retry immediately or with delay
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
            }
        }
        
        async function callGeminiAPI(userQuery, systemPrompt) {
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                return await retryFetch(API_URL, payload);
            } catch (error) {
                console.error("Gemini API call failed:", error);
                return "Error: Could not connect to the AI Vaidya. Please check your connection and try again.";
            }
        }


        // --- Firebase Initialization and Auth ---

        async function initFirebase() {
            if (!firebaseConfig) {
                console.error("Firebase configuration is missing.");
                showToast("Error: Firebase config missing. Cannot load data.", 'error');
                return;
            }
            
            // Set log level for debugging
            setLogLevel('Debug');
            
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Sign in using the provided custom token, or anonymously if not available
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Set up auth state change listener (This is crucial for setting userId)
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("User authenticated. UID:", userId);
                        // Once userId is set, start listening to data
                        initDashboard();
                        listenToAyurvedaProfile(userId); 
                    } else {
                        userId = null;
                        console.log("User signed out or anonymous.");
                        // Handle anonymous user or sign-out state if needed
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                showToast(`Auth Error: ${error.message}`, 'error');
            }
        }

        function logout() {
            signOut(auth).then(() => {
                showToast('Logged out successfully!');
                // Redirect or update UI after sign out (in a real app, this might go to a login page)
                console.log("User successfully signed out.");
                
                // For this environment, we clear the data placeholders
                document.getElementById('userName').textContent = 'Guest';
                document.getElementById('dashboardUserName').textContent = 'Guest';
                document.getElementById('userAvatarSmall').src = 'https://ui-avatars.com/api/?name=Guest&background=AAAAAA&color=fff';
                
            }).catch((error) => {
                console.error("Error signing out:", error);
                showToast(`Logout Error: ${error.message}`, 'error');
            });
        }
        
        // --- Firestore Data Listening and UI Update (omitted for brevity) ---

        function listenToAyurvedaProfile(currentUserId) {
            // Path: /artifacts/{appId}/users/{userId}/ayurveda/profile
            const profileRef = doc(db, `artifacts/${appId}/users/${currentUserId}/ayurveda`, 'profile');

            onSnapshot(profileRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    console.log("Ayurveda profile data received:", data);
                    updateDashboardUI(data);
                } else {
                    console.log("No Ayurveda profile data found. Setting up default data.");
                    // If no data exists, create a default profile for the new user
                    setDefaultProfile(currentUserId);
                }
            }, (error) => {
                console.error("Error listening to profile data:", error);
                showToast("Error fetching live data. Check console.", 'error');
            });
        }

        async function setDefaultProfile(currentUserId) {
            const defaultData = {
                name: "New Patient " + currentUserId.substring(0, 4),
                dosha: {
                    vata: 35,
                    pitta: 40,
                    kapha: 25
                },
                prakriti: "Pitta-Vata",
                prakriti_desc: "You have a predominant Pitta constitution with Vata tendencies",
                characteristics: [
                    "Strong digestion and metabolism",
                    "Sharp intellect and focus",
                    "Creative and energetic",
                    "Tendency towards heat sensitivity"
                ]
            };
            
            // Path: /artifacts/{appId}/users/{userId}/ayurveda/profile
            const profileRef = doc(db, `artifacts/${appId}/users/${currentUserId}/ayurveda`, 'profile');
            try {
                // Use setDoc to create the document if it doesn't exist
                await setDoc(profileRef, defaultData);
                console.log("Default profile created successfully.");
                // onSnapshot will now trigger with this data
            } catch (e) {
                console.error("Error adding default document: ", e);
                showToast("Could not set up default profile.", 'error');
            }
        }

        function updateDashboardUI(data) {
            const { name, dosha, prakriti, prakriti_desc, characteristics } = data;
            const totalDosha = dosha.vata + dosha.pitta + dosha.kapha;
            
            // Calculate percentages based on total (if not 100)
            const vataPct = Math.round((dosha.vata / totalDosha) * 100);
            const pittaPct = Math.round((dosha.pitta / totalDosha) * 100);
            const kaphaPct = 100 - vataPct - pittaPct; // Ensure total is exactly 100

            // 1. User Info
            document.getElementById('userName').textContent = name;
            document.getElementById('dashboardUserName').textContent = name;
            document.getElementById('userAvatarSmall').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=2D7A2E&color=fff`;

            // 2. Dosha Meter
            document.getElementById('vataPercentage').textContent = `${vataPct}%`;
            document.getElementById('vataBar').style.width = `${vataPct}%`;
            
            document.getElementById('pittaPercentage').textContent = `${pittaPct}%`;
            document.getElementById('pittaBar').style.width = `${pittaPct}%`;
            
            document.getElementById('kaphaPercentage').textContent = `${kaphaPct}%`;
            document.getElementById('kaphaBar').style.width = `${kaphaPct}%`;

            // 3. Prakriti Card
            document.getElementById('prakritiBadge').textContent = prakriti;
            document.getElementById('prakritiDescription').textContent = prakriti_desc;

            const charList = document.getElementById('prakritiCharacteristics');
            charList.innerHTML = ''; // Clear existing list
            characteristics.forEach(char => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fas fa-check-circle"></i> ${char}`;
                charList.appendChild(li);
            });
            
            // 4. Dosha Chart (Re-initialize or update)
            initDoshaChart(vataPct, pittaPct, kaphaPct);
        }

        // --- AI VAIDYA Logic ---

        let chatHistory = [];
        const CHAT_ASSISTANT_SYSTEM_PROMPT = "You are 'AI Vaidya,' an expert, compassionate Ayurvedic advisor. Your responses must be entirely based on principles of Ayurveda (Doshas, Prakriti, Dinacharya, Ritucharya, Gunas, etc.). You must provide balanced recommendations suitable for a user whose profile is Pitta-Vata. Keep your answers supportive, encouraging, and focused on holistic well-being. Do not offer Western medical advice.";
        const REPORT_ANALYZER_SYSTEM_PROMPT = "You are 'AI Vaidya,' an expert Ayurvedic Report Analyzer. Analyze the provided clinical or personal health report text from an Ayurvedic perspective. Your analysis must: 1. Identify the dominant Dosha(s) potentially aggravated (Vikriti). 2. Suggest specific Ayurvedic factors (Agnƒ´, DhƒÅtus, Mala) that might be imbalanced. 3. Provide 3 highly specific and actionable lifestyle or herbal recommendations to address the imbalances based on Ayurvedic principles. Format the output using markdown headings and lists.";

        function appendMessage(sender, text) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender === 'user' ? 'user-message' : 'assistant-message');
            
            // Simple markdown rendering for AI output
            messageDiv.innerHTML = sender === 'user' ? text : DOMPurify.sanitize(marked.parse(text));
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to bottom
        }

        async function handleChatSubmit() {
            const chatInput = document.getElementById('chatInput');
            const chatSubmitBtn = document.getElementById('chatSubmit');
            const userQuery = chatInput.value.trim();

            if (userQuery === "") return;

            // 1. Display user message and clear input
            appendMessage('user', userQuery);
            chatInput.value = "";
            chatSubmitBtn.disabled = true;
            chatInput.placeholder = "AI Vaidya is thinking...";

            try {
                // 2. Add loading indicator temporarily
                appendMessage('assistant', '<div class="loader"></div>');
                const loader = document.querySelector('#chatMessages .loader');
                
                const responseText = await callGeminiAPI(userQuery, CHAT_ASSISTANT_SYSTEM_PROMPT);

                // 3. Remove loader and display response
                if (loader && loader.parentElement) {
                    loader.parentElement.remove();
                }
                appendMessage('assistant', responseText);
                chatHistory.push({ role: 'user', content: userQuery });
                chatHistory.push({ role: 'assistant', content: responseText });

            } catch (error) {
                appendMessage('assistant', "Sorry, I encountered an error. Please try again.");
                console.error("Chat API error:", error);
            } finally {
                chatSubmitBtn.disabled = false;
                chatInput.placeholder = "Ask about Pitta-Vata balance, Ashwagandha, etc...";
            }
        }

        async function handleAnalyzeReport() {
            const reportInput = document.getElementById('reportInput');
            const reportOutput = document.getElementById('reportOutput');
            const analyzeBtn = document.getElementById('analyzeReportBtn');
            const loader = document.getElementById('reportLoader');
            const reportText = reportInput.value.trim();

            if (reportText.length < 50) {
                showToast("Please enter a more detailed report or symptom list for analysis.", 'error');
                return;
            }

            analyzeBtn.disabled = true;
            loader.classList.remove('hidden');
            reportOutput.innerHTML = '<p class="text-center text-gray-500">Analyzing your report and synthesizing Ayurvedic principles...</p>';

            const fullQuery = `User's current Prakriti (Constitution) is Pitta-Vata. Please analyze the following health report/symptoms: ${reportText}`;
            
            try {
                const responseText = await callGeminiAPI(fullQuery, REPORT_ANALYZER_SYSTEM_PROMPT);
                
                // Use simple markdown library to render the structured response
                reportOutput.innerHTML = DOMPurify.sanitize(marked.parse(responseText));

            } catch (error) {
                reportOutput.innerHTML = `<p class="text-red-600">Error: The AI Vaidya could not complete the analysis. Please check the input text and your connection.</p>`;
                console.error("Report Analyzer API error:", error);
            } finally {
                analyzeBtn.disabled = false;
                loader.classList.add('hidden');
            }
        }


        // --- Chart and General UI Functions (unchanged logic, updated to use dynamic data) ---

        window.addEventListener('DOMContentLoaded', function() {
            initFirebase();
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Set up static listeners that don't depend on Firebase data immediately
            const today = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', options);

            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('active');
            });

            document.getElementById('sidebarToggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('collapsed');
                // Adjust main content margin manually for smooth transition
                const mainContent = document.querySelector('.main-content');
                if (document.getElementById('sidebar').classList.contains('collapsed')) {
                    mainContent.style.marginLeft = '90px';
                } else {
                    mainContent.style.marginLeft = '280px';
                }
            });

            // Initialize event listeners for AI Vaidya section
            document.getElementById('chatSubmit').addEventListener('click', handleChatSubmit);
            document.getElementById('analyzeReportBtn').addEventListener('click', handleAnalyzeReport);

        });

        function initDashboard() {
            // Only set up dynamic listeners that require auth/db objects here
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    switchSection(section);
                });
            });
            
            // Add external libraries for markdown rendering and security
            const scriptMarked = document.createElement('script');
            scriptMarked.src = 'https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.17/marked.min.js';
            document.head.appendChild(scriptMarked);
            
            const scriptDomPurify = document.createElement('script');
            scriptDomPurify.src = 'https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js';
            document.head.appendChild(scriptDomPurify);
        }
        
        function switchSection(section) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === section) {
                    item.classList.add('active');
                }
            });

            document.querySelectorAll('.content-section').forEach(sec => {
                sec.classList.remove('active');
            });
            document.getElementById('section-' + section).classList.add('active');

            const titles = {
                'dashboard': 'Ayurveda Dashboard',
                'dosha': 'Dosha Analysis',
                'herbs': 'Herbal Medicines',
                'diet': 'Diet & Lifestyle',
                'panchakarma': 'Panchakarma',
                'consultations': 'Consultations',
                'seasonal': 'Seasonal Guide',
                'yoga': 'Yoga & Meditation',
                'ai-vaidya': 'AI Vaidya Assistant', // New Title
                'settings': 'Settings'
            };
            document.getElementById('pageTitle').textContent = titles[section];
        }

        function initDoshaChart(vataPct = 35, pittaPct = 40, kaphaPct = 25) {
            const ctx = document.getElementById('doshaChart');
            if (!ctx) return;
            
            // Destroy existing chart instance if it exists
            if (doshaChartInstance) {
                doshaChartInstance.destroy();
            }

            doshaChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Vata (Air & Space)', 'Pitta (Fire & Water)', 'Kapha (Water & Earth)'],
                    datasets: [{
                        data: [vataPct, pittaPct, kaphaPct],
                        backgroundColor: ['#87CEEB', '#FF6347', '#90EE90'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    family: 'Inter',
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Expose functions globally for testing/debugging if necessary
        window.logout = logout;
        window.showToast = showToast; 
        
    </script>
</body>
</html>
